---
title: Javascript动画实现原理
type: "categories"
categories: [前端, JS, 基本概念]
---

## 运动的本质
> 让某个元素的某个属性到目标上去中小数精度问题：所以用整数做运算

### 步骤
> 第一步清除定时器；
第二步开启定时器
第三部改变坐标，运动
定时器和坐标
匀速运动必须保持距离恰好能整除速度
点一下开一个定时器，重复点击的bug，所以事先就要清除定时器，每次只能开一个
定时器的清除：不同的物体用各自的定时器，防止互相影响

## 运动的形式

###  摩擦运动
> 逐渐变慢，到停止

### 缓冲运动
> 可以精确到某个目的点，距离越远，速度越大
> 速度 = （目标值 - 当前值）/缩放系数
> bug: 速度取整， 值取整

问题：
```
	1.如果让speed--，但是为负数的时候会跑回来
	2.所以可以让speed/正数，或者speed*（0-1）的数，就可以是减速运动，但是不能准确到达目标点
```

解决方案：
```
speed = （500-offsetLeft）*0.8  //按常理来说是无限接近终点
但是还是不能准确到终点
为什么会造成这情况呢
```
```
上面的代码中，我们只加入了一行代码，用于监控Div的当前位置（这是一种常用的调试手段）：
document.title=oDiv.offsetLeft;
运行这段代码后，我们看到物体的位置，最终停在293像素的位置，不再向前走了，这是为什么呢？
实际上，当物体距离目标点非常近的时候，距离可能会小于缩放系数，这时速度会是一个小数。而浏览器能接受的都是整数（像素），给他一个小数，会自动忽略小数部分，物体不会发生实际的移动。

因为offsetWidth是经过js内部运算过后的，是没有单位的，他运算方式是四舍五入运算

当速度小于0.5的时候，会一直处于舍得状态，所以一直到达不了终点，所以需要我们代码解决
所以对速度进行向上取整Math.ceil(speed)

但是到大于-0.5了如果从远返回的时候，speed为负值
所以负数要向下取整Math.floor(speed)
```
## 总结：
> 让某个元素的属性到目标上去
> 运动的形式和速度无关，和算法有关